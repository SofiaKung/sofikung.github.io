---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { hasDraftTag } from '../../utils/content';

const posts = (await getCollection('posts'))
  .filter((entry) => !hasDraftTag(entry))
  .sort((a, b) => {
    const aDate = a.data.date ? new Date(a.data.date).getTime() : 0;
    const bDate = b.data.date ? new Date(b.data.date).getTime() : 0;
    return bDate - aDate;
  });
---
<BaseLayout title="All Posts">
  <main class="article">
    <div class="container">
      <header class="article-header">
        <p class="article-eyebrow">Blog</p>
        <h1 class="article-title">All Posts</h1>
      </header>
      <section class="posts">
        <div class="post-list">
          {posts.map(({ slug, data }) => (
            <article class="post-card">
              <a class="post-link" href={`/post/${slug}`}>
                <header class="post-header">
                  <h3 class="post-title">{data.title}</h3>
                  {data.date && <time class="post-date" datetime={data.date}>{data.date_pretty ?? data.date}</time>}
                </header>
                <p class="post-excerpt">{data.description ?? ''}</p>
                <div class="post-tags">{(data.tags ?? []).map(t => <span class="post-tag">{t}</span>)}</div>
              </a>
            </article>
          ))}
        </div>
      </section>
    </div>
  </main>
</BaseLayout>
